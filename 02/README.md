# 仮想サーバの作成

EC2を利用して実際に仮想サーバを作成して、簡単なwebアプリケーションを構築する方法について書かれている。

## EC2って何
- EC2 : _Elastic Compute Cloud_
- 仮想サーバを提供するサービス
- 必要なときに仮想サーバのスペックのアップや、台数などを増やしたりできる柔軟性を持つ

## EC2を使うにあたっての概念
### インスタンスタイプ
- サーバーのスペックを定義するもの
- インスタイプ毎に主にCPU、メモリ、ストレージ、ネットワーク帯域が違う

### AMI 
- AMI : _Amazon Machine Image_
- 仮想サーバの起動に必要な情報が含まれている。
    - インスタンス情報のバックアップや複製などに使うので重要

### EC2のストレージ
- 2種類のブロックデバイスがある。

#### EBS (EBSボリューム)
- EBS : _Elastic Block Store_
- 高い可用性と耐久性
- EBSのボリュームタイプによってパフォーマンスが異なる

タイプ|ハードウェア|特徴
:-:|:-:|:-:
General Purpose(GP2)|SSD|ルートボリュームや中小規模のデータベース
プロビジョンドIOPS(PIOPS)|SSD|高負荷なデータベース
Magnetic|磁気ディスク|読書速度やアクセス頻度が低い場合やコストを低くしたい場合

#### インスタンスストア
- インスタンス専用の一時的なストレージ
- 他のインスタンスに付け替えることは出来ない
- インスタンスを起動しているときのみ利用可能
- 算出時の一時ファイル置き場や再生性可能なファイルを使うのによい

#### 比較
ストレージタイプ|永続性|耐久性|パフォーマンス|用途|費用
:-:|:-:|:-:|:-:|:-:|:-:
EBS|高い|99.5~99.999%|ランダムアクセスに強い|永続性と耐久性が必要なストレージ|有料
インスタンスストア|低い|EBSより低い|シーケンシャルアクセスに強い|失われても問題ないストレージ|無料

### EC2を作成するために
#### キーペア
- インスタンスへの接続に必要
    - LinuxならSSH接続の公開鍵認証

#### セキュリティグループ
- EC2の外側にあるファイヤーウォールのようななもの
- 通信の入出力制御を行う
- 基本的に、
    - サーバへ入ってくる通信のポートは必要なものだけを開ける仕組み
    - サーバから出ていく通信のポートは全て空いている

## EC2の作成から起動
1. 利用するAMIの選択
1. インスタンスタイプの選択
1. インスタンスにセキュリティグループを設定
1. EIPの取得と付与


### EIP
- EIP : _Elastic IP Adress_
- インターネット経由でアクセス可能な固定グローバルIPアドレスが取得でき、インスタンスに付与できるサービス。
    - EC2インスタンスのpublic ipアドレスは再起動のたびに変わるため不便なため

## EC2への接続から稼働
稼働するためにはWebサーバ、データベースサーバ、アプリケーションサーバをインストールする必要があるらしい。\
ここらへんが今一イメージがつかない。。\
本書で使用したもの
- nginx
    - _フリーかつオープンソースなWebサーバ。_
    - _処理性能・高い並行性・メモリ使用量の小ささに焦点を当てて開発されており、HTTP, HTTPS, SMTP, POP3, IMAPのリバースプロキシの機能や、ロードバランサ、HTTPキャッシュの機能も持つ。_ by Wikipedia
- MySQL
    - _世界中で最もよく利用されているオープンソースのデータベースのひとつ。_
    - _高速で使いやすいことが特徴_ by Wikipedia
- Rails
    - Webアプリケーションを作成するためのフレームワーク


## Tips
- OSシャットダウンや、マネジメントコンソールからインスタンスを停止し、再度起動すると別のAWS上の物理サーバ上で起動する。とのこと
    - これを利用してAWS側の物理サーバ障害時は停止と再起動で復旧できる
- マネジメントコンソールによる再起動は物理サーバは変わらずインスタンスストアのデータも引き継がれる。


## 知見
- EC2、AMIあたりは少しだけやったことがあったので難しくなかった。
- EIPは知らなかったので勉強になった。
    - 以前アプリ開発の際にサーバのDB更新の度にIP覚えるの大変だった。。。
- 他にもコンソール画面での各項目が非常に細かく解説されていて勉強になった。
