# モニタリングとWebサーバのスケーリング(CloudWatch/Auto Scaling)

サーバをモニタリングする監視サービスであるCloudWatchの使い方と、自動でスケールアウト/スケールインをさせるAuto Scalingについて書かれています

## CloudWatchって何
- AWSのサービスの監視やモニタリングを出来るサービス
    - システムがダウンしていないか必要なリソースが確保されているかなどを定期的にチェックすることがシステム運用において必須
    - サーバのモニタリングは重要！
- 監視サーバなどを別途用意せずに利用できるが、通常の監視ソフトと比べるとモニタリング情報は少ない
- モニタリングツールとしては少し弱いが、モニタリングした値から自動でアクションを実行させることが可能

## Auto Scalingって何
- EC2インスタンスの台数を自動で増減させるサービス
    - スケールアウト/スケールイン
- 急なアクセス増加に柔軟に対応できる
- 無駄なインスタンスを使わないためEC2の課金料金も最適化出来る！
- Auto Scaling自体はスケールアウト/スケールインする際に、事前に設定されたスケーリングポリシーに従って振る舞う。
- そのため、Auto Scaling自体のアクションはCloudWatch等と組み合わせて外部から実行する必要がある。

#### 起動設定
- スケールアウトする際にどんなEC2インスタンスを起動するかを設定する
- EC2インスタンスを作成する際の内容と同じ

#### Auto Scalingグループの設定
- 使用する起動設定、グループ内のインスタンス最大数/最小数な等を設定する

#### スケーリングポリシー
- スケーリングのインスタンス台数やスケール条件などを設定する
- この際に設定する「スケール条件」がCloudWatchアラートに当たる

### 運用の注意点
- Auto Scalingで作成されたEC2インスタンスはランダムにパブリックDNSのアクセス先が設定される
- そのため、デプロイツールなどを使う際は動的にアクセス先を取得する必要がある
- またデプロイ後、起動設定で使用しているAMIも最新に更新しないといけない

## CloudWatch + Auto Scalingイメージ
![image](https://user-images.githubusercontent.com/12966452/34451814-3a3fb2aa-ed75-11e7-8c27-f73116483860.png)

## 知見
- サービス運用する上で自動でスケールアウト/スケールインをしてくれるAuto Scalingは強力なサービスだと感じた
- 自動化のメリットの分、運用の注意点で書いたようなデメリットもあるので意識して使っていきたい
- 企業はどんな監視ツール使っているのか気になった🤔