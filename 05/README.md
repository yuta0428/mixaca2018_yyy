# ネットワークの設計と設定(VPC)

仮想ネットワークを構築するVPCについてとその構築方法について書かれています。

## VPCって何
- VPC : _Virtual Private Cloud_
- 仮想ネットワーク
- (また、仮想ネットワークを構築できるAWS上のサービス名称)
- 外部ネットワークからインターネットへ接続可能なサブネット、データベースを配置するインターネットからは接続できないプライベートサブネットを作成できる。

|パブリッククラウド|プライベートクラウド|
|:-:|:-:|
|![image](https://user-images.githubusercontent.com/12966452/34414360-48fb083e-ec2c-11e7-89ef-e3ce9f068f51.png)|![image](https://user-images.githubusercontent.com/12966452/34414475-e1a04838-ec2c-11e7-86a7-39914915cd68.png)|
画像 : [クラウドだけどプライベートさえあれば関係ないよねっ – サーバーワークスエンジニアブログ](http://blog.serverworks.co.jp/tech/2012/11/27/awsvpcprivatecloud/)

外部から自由にサーバーにアクセス出来ないようサブネットなどで接続を制限する

### 注意点
- VPC作成にはVPCで使用するネットワークアドレスが必要
    - VPC全体でネットワークアドレスを定義し、その中で細かいサブネットを作成するイメージ！
- サブネットはアベイラビリティゾーンを越えられないという制限がある
    - 対障害性を考慮すると、複数のアベイラビリティゾーンを使用したほうが良い
- VPCもリージョンごとで独立しているため、複数リージョンでサービスを展開する際はアドレス設計に注意が必要


### AWSでの構築について
- VPCという大枠の中をサブネットで区切る
- VPC自体にはネットワークACLというセキュリティグループと同様の役割をもつファイアウォールを当てられる
    - ネットワークACLはサブネット単位で有効
- VPCのデフォルト設定ではでは内部のEC2が外部とのやり取りが出来ないので、インターネットゲートウェイの作成が必要
    - VPCとインターネットを繋げる仮想ルーターのようなイメージ！

## インターネットVPNによるVPCとの接続
- VPCとのインターネットVPN接続は２種類のルーティングをサポートしている
    - 静的ルーティング
    - 動的ルーティング
- AWSではCGW(カスタマーゲートウェイ)とVGW(仮想プライベートゲートウェイ)を用いて構築する。

#### 静的ルーティング
- VPNルータとAWS側の両方でネットワークアドレスに対してルーティングする必要がある
- 必要最低限のルーティング情報のみ設定すれば接続が可能

#### 動的ルーティング
- BCPを介してルーティングが伝播されるので管理が楽 
    - BCP : AS(自律システム)感でルート情報をやりとりするためのプロトコルらしいのですが、ﾁｮｯﾄﾖｸﾜｶﾗﾅｲ
- 必要以上のルーティングが対抗側に伝搬される可能性がある

## VPC同士の接続
- VPCは論理的に分離された仮想プライベートネットワークで、VPC館の相互関係や通信の影響は受けないようになっている
- VPCピアリング機能により、同リージョン内であれば異なるVPC感をインターネットを経由せずに相互に通信が可能になった。
![image](https://user-images.githubusercontent.com/12966452/34416271-11d95a36-ec36-11e7-981f-f014016fd432.png)


- 相互に接続されたVPC間はプライベートアドレスでのローカルネットワーク通信が可能になる。
    - 監視システムの用のVPCと別システムのVPCをピアリングしてローカルネットワークで通信で監視するといった使い方が可能！

## 知見
- 基盤サービスなどセキュリティを意識したネットワーク設計にするためにVPCやCGW、VPWについて知れた。
- 図でのイメージは出来たが実際に組むとなると環境を用意してないため、アクセス制限を体験するまで至ってないのでそこは今後理解していきたい
- 専門用語が徐々に増えてきてインフラを勉強するには予備知識がさらに必要だと痛感した。。。