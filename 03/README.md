#  仮想サーバの強化(EC2応用編)

バックアップの作成、スケールアップ、容量追加などについて解説されている。

## バックアップの作成

### インスタンスからAMI作成
- インスタンスの全てをアーカイブする方法。
- インスタンスの現在の状態を元にAMIを作成する
    - これにより、EC2のインスタンスとアタッチされているEBSのデータを1つのAMIにパッケージ化することができる。
- AMIを定期的に作成することで、不慮の事故の際にも、直近のAMIから復帰できる

### EBSのスナップショット
- EBSボリューム単体でアーカイブする方法。
- スナップショットからAMIを作成可能


## スケールアップ
- Webアクセスや計算処理負荷に応じて、インスタンスを増強すること
- インスタンスタイプを変更することでスケールアップ出来る。
- EBSかインスタンスストアかでやり方が違うので注意

## 容量追加
### ディスク容量の追加
- インスタンスに新しいボリュームを追加すること。
- 追加したいインスタンスと同じアベイラビリティゾーンにしたボリュームを作成し、アタッチする
−注意
    - 初期化し、マウントしてあげる必要あり
    - インスタンスの再起動時にマウントが外れるため自動マウントの設定必要

### ルートボリュームの容量追加
- AMI作成時にルートボリュームの容量を変更する方法
- 作成したAMIを元に起動した新しいEC2インスタンスを、ELBに接続するなどで付け替えることで拡張が可能。

### 追加ボリュームの容量追加
- ルートデバイス以外のEBSボリュームを追加する方法
- EC2インスタンスを停止し、容量を追加したいボリュームのスナップショットをとる。
- スナップショットを元に、新しくボリュームを作成し、インスタンスのボリュームを入れ替える。

## I/Oの高速化
主にEBSを使用した際のパフォーマンスアップ方法
### プロビジョンドIOPSの設定
- プロビジョンドIOPSを指定することで、パフォーマンスのレベルを満たすようにすることが出来る。
- 必要なIOPSがわかっている場合に、有効！


### EBS最適化オプション
-  EC2とEBS間のネットワーク帯域を専有させることで、EBSへのアクセスを最大化し、パフォーマンスの向上と安定を図ることが出来る。
- プロビジョンドIOPSはネットワークがボトルネックになりやすいので、このオプションと併用したほうが良い！

### RAID
- RAID : _Redundant Arrays of Inexpensive Disks_
    - _複数台のハードディスクを組み合わせることで仮想的な1台のハードディスクとして運用し冗長性を向上させる技術。_ by Wikipedia
- EBSでRAIDを組むことでディスクI/O速度を高速化させる。
- 一般的にはRAID0。とのこと

#### ボリュームの暖機を事前に済ます。
- 暖機 : EBSへの初めてのアクセスの際に内部で走る準備処理のこと。
    - この間はパフォーマンスが低下する。
- 予めボリュームの全てブロックに対して読み書きを実行させておくことで、パフォーマンスを低下させないようにする。

### インスタンスストアの利用
- 高速なSSDを搭載したインスタンスタイプでは、インスタンスストアは高いI/Oパフォーマンスを発揮できるため。

## アプリケーション管理サービス
### Elastic Beanstalk
- 複数の環境で、負荷分散、監視、容量設定、ミドルウェアのインストール、アプリケーションの配備を自動で行うことが出来る。
- アプリケーションプラットフォームの管理まで行うことが出来る
- 専任でなくても短時間でインフラ構築したい場合に最適。とのこと。

### OpsWorks
- EC2、Auto Scaling、アプリケーションデプロイ、監視、ユーザ権限などを管理
- EC2内部のアプリケーションプラットフォームの作成をChefレシピで実行できる
- Elastic Beanstalsよりも柔軟分、専任者が運用効率や作業の統一性を求める場合に優れた効果を発揮する。とのこと


### CloudFormation
- ほとんどのAWSリソースの構築と設定を行うことが出来るサービス
- 構成を記述したJsonオーマットを雛形とすることで、構築時の手間を最小限に抑えることができる。とのこと

### 比較
ソリューション|特徴|簡単さ|自由さ
|:-:|:-:|:-:|:-:
Elastic Beanstalk|プリセットから設定項目を変更する|◎|×
OpsWork|Chefでプリセット以外も設定可能|○|△
CloudFormation|ほぼすべてのAWSリソースを雛形から作成|△|○
手動設定|自由|×|◎

### サードパーティ製ツール
- Chef
- Puppet
- VisualOps


## 知見
- ひと通り拡張手法やってみたが、ボリューム追加が少し手順として複雑だった
- サーバ強化の手法は要因に対して、とり得る方法が違うと思うので、強化方法だけでなく、どういうときに有効かも意識していきたいと思った。
- OpsWorksは使用したことがあったが、他にも管理サービスがあることを知ることが出来た。
    - 企業は何のサービス使っているか気になる。
- テクニック的な内容のため、本の内容をただ記述している感じになってしまったので読みづらいかも。。
